<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPH | Cyber ResearchOS</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Rajdhani:wght@500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Libraries -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Rajdhani', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        cyber: {
                            bg: '#050a14',
                            panel: '#0a1124',
                            cyan: '#00f3ff',
                            blue: '#0077ff',
                            purple: '#bc13fe',
                            danger: '#ff2a6d'
                        }
                    },
                    animation: {
                        'scan': 'scan 3s linear infinite',
                        'pulse-glow': 'pulseGlow 3s infinite',
                        'fade-in': 'fadeIn 0.4s ease-out forwards',
                    },
                    keyframes: {
                        scan: { '0%': { transform: 'translateY(-100%)' }, '100%': { transform: 'translateY(100%)' } },
                        pulseGlow: { '0%, 100%': { boxShadow: '0 0 5px rgba(0, 243, 255, 0.2)' }, '50%': { boxShadow: '0 0 20px rgba(0, 243, 255, 0.6)' } },
                        fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } }
                    }
                }
            }
        }
    </script>

    <style>
        /* --- CORE THEME & SCROLLBARS --- */
        body { background-color: #050a14; color: #e2e8f0; overflow: hidden; transition: background-color 0.3s ease, color 0.3s ease; }
        html:not(.dark) body { background-color: #f8fafc; color: #1e293b; }

        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        .dark .custom-scroll::-webkit-scrollbar-thumb { background: #0077ff; }
        html:not(.dark) .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; }

        /* --- GLASSMORPHISM --- */
        .glass { background: rgba(10, 17, 36, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(0, 243, 255, 0.1); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1); }
        html:not(.dark) .glass { background: rgba(255, 255, 255, 0.9); border: 1px solid #e2e8f0; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }

        /* --- NEON BUTTONS --- */
        .btn-cyber {
            background: linear-gradient(90deg, rgba(0,243,255,0.1) 0%, rgba(0,119,255,0.1) 100%);
            border: 1px solid rgba(0,243,255,0.3); color: #00f3ff;
            transition: all 0.2s ease; position: relative; overflow: hidden;
            display: inline-flex; align-items: center; justify-content: center;
            text-transform: uppercase; letter-spacing: 0.05em; cursor: pointer;
        }
        .btn-cyber:hover {
            background: rgba(0,243,255,0.2); box-shadow: 0 0 15px rgba(0,243,255,0.4);
            border-color: #00f3ff; text-shadow: 0 0 8px #00f3ff; transform: translateY(-2px);
        }
        .btn-cyber:active { transform: translateY(0); }

        .btn-cyber-solid {
            background: #00f3ff; color: #050a14; font-weight: bold;
            box-shadow: 0 0 10px rgba(0,243,255,0.5); border: none;
            display: inline-flex; align-items: center; justify-content: center;
            text-transform: uppercase; letter-spacing: 0.05em; transition: all 0.2s ease; cursor: pointer;
        }
        .btn-cyber-solid:hover { background: #fff; box-shadow: 0 0 20px rgba(0,243,255,0.8); transform: translateY(-2px); }
        
        /* Light Mode Button Overrides */
        html:not(.dark) .btn-cyber { background: rgba(79, 70, 229, 0.1); border: 1px solid rgba(79, 70, 229, 0.5); color: #4f46e5; text-shadow: none; }
        html:not(.dark) .btn-cyber:hover { background: rgba(79, 70, 229, 0.2); box-shadow: 0 0 10px rgba(79, 70, 229, 0.3); }
        html:not(.dark) .btn-cyber-solid { background: #4f46e5; color: white; box-shadow: 0 0 10px rgba(79, 70, 229, 0.4); }
        html:not(.dark) .btn-cyber-solid:hover { background: #4338ca; }
        
        /* --- UTILS --- */
        .tech-border { clip-path: polygon(0 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%); }
        .tech-border-inv { clip-path: polygon(0 0, calc(100% - 15px) 0, 100% 15px, 100% 100%, 0 100%); }
        
        .theme-toggle { width: 44px; height: 22px; border-radius: 99px; cursor: pointer; position: relative; background: #e2e8f0; border: 1px solid #cbd5e1; }
        .dark .theme-toggle { background: #0f172a; border: 1px solid rgba(0, 243, 255, 0.3); }
        .theme-thumb { width: 16px; height: 16px; border-radius: 50%; background: white; position: absolute; top: 2px; left: 2px; transition: 0.3s; box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        .dark .theme-thumb { transform: translateX(22px); background: #00f3ff; box-shadow: 0 0 8px #00f3ff; }

        .scan-line { position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: rgba(0,243,255,0.5); box-shadow: 0 0 10px #00f3ff; opacity: 0; transition: opacity 0.2s; pointer-events: none;}
        .tech-card:hover .scan-line { opacity: 1; animation: scan-card 1.5s linear infinite; }
        @keyframes scan-card { 0% { top: 0; } 100% { top: 100%; } }
        
        .markdown-body h1 { font-size: 1.5em; font-weight: bold; margin-bottom: 0.5em; border-bottom: 1px solid #333; padding-bottom: 0.3em; }
        html:not(.dark) .markdown-body h1 { border-color: #e2e8f0; color: #1e293b; }
        
        .card-hover { transition: transform 0.2s, box-shadow 0.2s; }
        .card-hover:hover { transform: translateY(-4px); }
    </style>
</head>
<body class="text-gray-300 font-sans h-screen flex flex-col transition-colors duration-300">

    <!-- SPLASH SCREEN -->
    <div id="splash" class="fixed inset-0 z-[9999] bg-[#050a14] flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="text-4xl font-bold font-mono tracking-tighter text-white glitch-text">CPH_OS v9.0</div>
        <div class="text-cyber-cyan font-mono text-xs mt-2">INITIALIZING NEURAL LINK...</div>
        <div class="w-[200px] h-[2px] bg-slate-800 mt-5 relative overflow-hidden"><div class="absolute top-0 left-0 h-full w-full bg-cyber-cyan animate-[load_1.5s_ease-in-out_forwards] origin-left scale-x-0"></div></div>
        <style> @keyframes load { 0% { transform: scaleX(0); } 100% { transform: scaleX(1); } } </style>
    </div>

    <!-- BG CANVAS -->
    <canvas id="bg-canvas" class="fixed inset-0 z-0 opacity-20 dark:opacity-40 pointer-events-none"></canvas>

    <!-- NAVBAR -->
    <nav class="glass z-50 h-16 border-b border-white/5 sticky top-0 transition-colors duration-300">
        <div class="max-w-7xl mx-auto px-4 h-full flex justify-between items-center">
            <!-- LOGO -->
            <div class="flex items-center gap-3 cursor-pointer group" onclick="router('home')">
                <div class="w-10 h-10 bg-indigo-100 dark:bg-cyber-cyan/10 border border-indigo-200 dark:border-cyber-cyan rounded flex items-center justify-center relative overflow-hidden">
                    <i class="ph-bold ph-circuitry text-indigo-600 dark:text-cyber-cyan text-xl relative z-10"></i>
                </div>
                <div>
                    <h1 class="font-bold text-xl text-slate-900 dark:text-white tracking-tight leading-none">CyPro<span class="text-indigo-600 dark:text-cyber-cyan">Harvest</span></h1>
                    <span class="text-[10px] font-mono text-slate-500 dark:text-cyber-blue tracking-widest font-bold">RESEARCH OS</span>
                </div>
            </div>

            <!-- NAV LINKS -->
            <div class="hidden md:flex gap-1 bg-slate-100 dark:bg-black/20 p-1 rounded-lg border border-slate-200 dark:border-white/5">
                <button onclick="router('home')" id="nav-home" class="px-4 py-1.5 rounded text-sm font-medium transition-colors">Home</button>
                <button onclick="router('dashboard')" id="nav-dashboard" class="px-4 py-1.5 rounded text-sm font-medium transition-colors">Dashboard</button>
                <button onclick="router('explore')" id="nav-explore" class="px-4 py-1.5 rounded text-sm font-medium transition-colors">Explore</button>
                <button onclick="router('ai')" id="nav-ai" class="px-4 py-1.5 rounded text-sm font-medium text-purple-600 dark:text-cyber-purple flex items-center gap-1"><i class="ph-bold ph-sparkle"></i> AI Lab</button>
            </div>

            <!-- RIGHT CONTROLS -->
            <div class="flex items-center gap-4">
                <!-- Theme Toggle -->
                <div class="flex items-center gap-2">
                    <i class="ph-fill ph-sun text-amber-500 text-xs dark:text-slate-600"></i>
                    <button onclick="toggleTheme()" class="theme-toggle"><div class="theme-thumb"></div></button>
                    <i class="ph-fill ph-moon text-slate-400 text-xs dark:text-cyber-cyan"></i>
                </div>

                <!-- User Menu -->
                <div class="relative" id="user-menu-container">
                    <button onclick="toggleUserMenu()" class="w-9 h-9 rounded bg-gradient-to-tr from-indigo-500 to-cyan-400 p-[2px] hover:shadow-[0_0_10px_rgba(0,243,255,0.5)] transition-shadow">
                        <div class="w-full h-full bg-white dark:bg-[#0a1124] rounded flex items-center justify-center text-xs font-bold text-slate-900 dark:text-white">US</div>
                    </button>
                    <!-- Dropdown -->
                    <div id="user-dropdown" class="hidden absolute right-0 mt-3 w-48 glass rounded-xl border border-slate-200 dark:border-white/10 shadow-2xl overflow-hidden transform origin-top-right z-50 animate-fade-in">
                        <div class="px-4 py-3 border-b border-slate-200 dark:border-white/10 bg-slate-50 dark:bg-white/5">
                            <p class="text-[10px] text-slate-400 uppercase font-bold">Signed In</p>
                            <p class="text-sm font-bold text-slate-800 dark:text-white truncate">User System</p>
                        </div>
                        <div class="py-1">
                            <a href="#" onclick="router('saved'); toggleUserMenu()" class="block px-4 py-2 text-sm text-slate-600 dark:text-slate-300 hover:bg-indigo-50 dark:hover:bg-white/10 flex items-center gap-2 transition-colors">
                                <i class="ph-bold ph-bookmark-simple text-indigo-500 dark:text-cyber-cyan"></i> Saved Projects
                            </a>
                        </div>
                        <div class="border-t border-slate-200 dark:border-white/10 py-1">
                            <a href="#" onclick="toggleUserMenu()" class="block px-4 py-2 text-sm text-red-400 hover:text-red-300 hover:bg-red-500/10 flex items-center gap-2 transition-colors">
                                <i class="ph-bold ph-sign-out"></i> Sign Out
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTAINER -->
    <div id="main-container" class="flex-1 overflow-y-auto relative z-10 p-4 md:p-8 custom-scroll"></div>

    <!-- MODAL -->
    <div id="modal-overlay" class="fixed inset-0 bg-slate-900/80 dark:bg-black/90 backdrop-blur-md z-[100] hidden flex items-center justify-center p-4 opacity-0 transition-opacity duration-300" onclick="if(event.target.id==='modal-overlay')closeModal()">
        <div class="glass w-full max-w-3xl tech-border bg-white dark:bg-[#0a1124] relative transform scale-95 transition-transform duration-300 flex flex-col max-h-[90vh]" id="modal-content">
            <!-- Header -->
            <div class="p-6 border-b border-slate-200 dark:border-white/10 flex justify-between items-start bg-gradient-to-r from-indigo-50 dark:from-cyber-blue/10 to-transparent flex-shrink-0">
                <div>
                    <div class="flex items-center gap-2 mb-2">
                        <span id="modal-category" class="font-mono text-[10px] font-bold px-2 py-0.5 rounded bg-indigo-100 dark:bg-cyber-cyan/10 text-indigo-600 dark:text-cyber-cyan border border-indigo-200 dark:border-cyber-cyan/30 uppercase tracking-wider inline-block">Category</span>
                    </div>
                    <h2 id="modal-title" class="text-2xl md:text-3xl font-bold text-slate-900 dark:text-white font-mono tracking-tight">Title</h2>
                </div>
                <div class="flex gap-3 items-center">
                    <button id="modal-save-btn" onclick="toggleSaveProject()" class="text-slate-400 hover:text-indigo-500 dark:hover:text-cyber-cyan transition p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-white/5" title="Save to Collection">
                        <i id="modal-save-icon" class="ph-bold ph-bookmark-simple text-2xl"></i>
                    </button>
                    <button onclick="closeModal()" class="text-slate-400 hover:text-red-500 transition text-2xl">&times;</button>
                </div>
            </div>
            <!-- Body -->
            <div class="p-8 overflow-y-auto flex-1 custom-scroll relative">
                <div class="flex border-b border-slate-200 dark:border-white/10 mb-6 sticky top-0 bg-white dark:bg-[#0a1124] z-20 pt-2">
                    <button onclick="switchTab('overview')" id="tab-overview" class="px-6 py-2 text-sm font-bold text-indigo-600 dark:text-cyber-cyan border-b-2 border-indigo-600 dark:border-cyber-cyan bg-indigo-50 dark:bg-cyber-cyan/5 transition-all">Overview</button>
                    <button onclick="switchTab('plan')" id="tab-plan" class="px-6 py-2 text-sm font-bold text-slate-500 dark:text-gray-500 hover:text-slate-900 dark:hover:text-white transition-all">Implementation</button>
                </div>
                <div id="view-modal-overview" class="space-y-6 animate-fade-in">
                    <div><h4 class="text-xs font-mono text-slate-500 dark:text-gray-500 uppercase mb-2 font-bold">// BRIEF</h4><p id="modal-desc" class="text-slate-700 dark:text-gray-300 text-sm leading-relaxed"></p></div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-slate-50 dark:bg-black/30 p-4 border border-slate-200 dark:border-white/5 rounded tech-border"><h4 class="text-xs font-mono text-indigo-600 dark:text-cyber-blue uppercase mb-3 font-bold">// TECH STACK</h4><div id="modal-stack" class="flex flex-wrap gap-2"></div></div>
                        <div class="bg-slate-50 dark:bg-black/30 p-4 border border-slate-200 dark:border-white/5 rounded tech-border"><h4 class="text-xs font-mono text-purple-600 dark:text-cyber-purple uppercase mb-3 font-bold">// UTILITY</h4><p id="modal-utility" class="text-sm font-bold text-slate-800 dark:text-white"></p></div>
                    </div>
                    <div><h4 class="text-xs font-mono text-slate-500 dark:text-gray-500 uppercase mb-2 font-bold">// MECHANISM</h4><div class="bg-slate-100 dark:bg-[#050a14] p-4 border border-slate-200 dark:border-white/10 rounded font-mono text-sm text-indigo-600 dark:text-cyber-cyan/80 shadow-inner"><span class="text-indigo-400 dark:text-cyber-blue">root@cph:~#</span> <span id="modal-mechanism"></span></div></div>
                </div>
                <div id="view-modal-plan" class="hidden h-full flex flex-col animate-fade-in">
                    <div id="plan-intro" class="text-center py-12 flex-1 flex flex-col items-center justify-center">
                        <i class="ph-duotone ph-cpu text-6xl text-slate-300 dark:text-gray-700 mb-4 animate-pulse"></i>
                        <p class="text-slate-500 dark:text-gray-400 mb-6 font-mono text-sm">INITIALIZE AI ARCHITECT FOR TACTICAL ANALYSIS</p>
                        <button onclick="window.generateImplementationPlan()" class="btn-cyber px-8 py-3 rounded uppercase font-bold text-sm tracking-widest">Compile Plan</button>
                    </div>
                    <div id="plan-loading" class="hidden text-center py-12 flex-1 flex flex-col items-center justify-center"><div class="w-12 h-12 border-4 border-indigo-200 dark:border-cyber-cyan/30 border-t-indigo-600 dark:border-t-cyber-cyan rounded-full animate-spin mx-auto mb-4"></div><p class="text-indigo-600 dark:text-cyber-cyan font-mono text-xs tracking-widest animate-pulse">PROCESSING...</p></div>
                    <div id="plan-content" class="hidden markdown-body text-sm text-slate-700 dark:text-gray-300 bg-slate-50 dark:bg-black/20 p-6 rounded border border-slate-200 dark:border-white/10"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t border-slate-200 dark:bg-[#050a14] dark:border-white/5 py-8 text-center z-10 relative">
        <p class="text-slate-500 dark:text-slate-400 text-sm font-medium">&copy; 2025 CyProHarvest. Made by <span class="text-indigo-600 dark:text-white font-bold">Sohel</span>.</p>
    </footer>

    <!-- JS -->
    <script>
        // --- DATA ENGINE ---
        const genTechs = ["Rust", "Go", "Python", "eBPF", "SDR", "C++", "Solidity", "TensorFlow", "Node.js", "Bash"];
        const genTargets = ["Kubernetes Cluster", "Smart Toaster", "Tesla Model 3", "Pacemaker", "Bitcoin Wallet", "AWS Lambda", "5G Tower", "Redis Server", "Zoom Client", "Traffic Light", "Industrial PLC", "Drone Swarm", "NFC Terminal", "GitLab CI"];
        const genVectors = ["Buffer Overflow", "Side-Channel", "MITM", "DNS Rebinding", "Supply Chain Injection", "SQL Injection", "Ransomware", "Privilege Escalation", "Fuzzing", "Signal Jamming"];

        const db = Array.from({length: 500}, (_, i) => {
            const id = i + 1;
            const tech = genTechs[id % genTechs.length];
            const target = genTargets[id % genTargets.length];
            const vector = genVectors[id % genVectors.length];
            let cat = "Offensive";
            if(target.includes("Smart") || target.includes("Drone") || target.includes("PLC")) cat = "IoT";
            else if(target.includes("AWS") || target.includes("Azure") || target.includes("Kubernetes")) cat = "Cloud";
            else if(vector.includes("Fuzzing")) cat = "Defensive";
            let diff = (id % 3 === 0) ? "Advanced" : ((id % 2 === 0) ? "Intermediate" : "Beginner");
            return { 
                id, title: `${target} ${vector}`, category: cat, difficulty: diff, stack: [tech, "Linux", "Docker"], 
                desc: `Analyze security posture of ${target} using ${tech}-based ${vector.toLowerCase()}. Includes PoC development and mitigation strategies.`,
                utility: `Critical research for ${cat.toLowerCase()} environments.`,
                mechanism: `Intercepts ${target} protocol via ${tech}, injecting payloads to trigger ${vector}.`
            };
        });

        // --- STATE ---
        let savedIds = new Set();
        let activeId = null;
        let currentFilter = { category: 'All', difficulty: 'All', search: '' };
        let visibleCount = 24;
        let charts = {}; // Store chart instances

        // --- THEME ---
        function initTheme() {
            const saved = localStorage.getItem('theme');
            if(saved === 'light') document.documentElement.classList.remove('dark');
            else document.documentElement.classList.add('dark');
        }
        function toggleTheme() {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            animate(); 
            if(document.getElementById('catChart')) initCharts();
        }
        initTheme();

        // --- MENU ---
        function toggleUserMenu() { document.getElementById('user-dropdown').classList.toggle('hidden'); }
        document.addEventListener('click', e => {
            const container = document.getElementById('user-menu-container');
            if(container && !container.contains(e.target)) document.getElementById('user-dropdown').classList.add('hidden');
        });

        // --- VIEWS ---
        const views = {
            home: () => `
                <div class="max-w-7xl mx-auto px-4 py-16 animate-fade-in text-center">
                    <div class="inline-block px-3 py-1 bg-indigo-100 dark:bg-cyber-blue/10 border border-indigo-200 dark:border-cyber-blue/30 rounded text-indigo-700 dark:text-cyber-blue text-xs font-mono mb-4 tracking-widest font-bold">SYSTEM V9.1 ONLINE</div>
                    <h1 class="text-5xl md:text-7xl font-black text-slate-900 dark:text-white mb-6 tracking-tight">CYPRO<span class="text-indigo-600 dark:text-cyber-cyan">HARVESTER</span></h1>
                    <p class="text-xl text-slate-600 dark:text-gray-400 max-w-2xl mx-auto mb-10">The ultimate open-source intelligence database for cybersecurity research projects.</p>
                    
                    <!-- Quick Search on Home -->
                    <div class="max-w-lg mx-auto mb-10 relative">
                         <i class="ph-bold ph-magnifying-glass absolute left-4 top-3.5 text-slate-400 dark:text-cyber-cyan"></i>
                         <input type="text" placeholder="Quick Search..." onkeydown="if(event.key === 'Enter') { window.preSearch = this.value; router('explore'); }"
                                class="w-full bg-slate-50 dark:bg-black/50 border border-slate-300 dark:border-cyber-cyan/30 rounded-lg py-3 pl-12 text-slate-900 dark:text-white focus:border-indigo-500 dark:focus:border-cyber-cyan outline-none font-mono text-sm shadow-lg">
                    </div>

                    <div class="flex flex-col md:flex-row justify-center gap-4">
                        <button onclick="router('explore')" class="btn-cyber-solid px-10 py-4 rounded text-sm font-bold uppercase tracking-widest hover:scale-105 transition-transform">Access Database</button>
                        <button onclick="router('dashboard')" class="btn-cyber px-10 py-4 rounded text-sm font-bold uppercase tracking-widest hover:scale-105 transition-transform">Dashboard</button>
                    </div>
                </div>`,
            dashboard: () => `
                <div class="max-w-7xl mx-auto px-4 py-8 animate-fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        ${renderStat('Total', db.length, 'text-slate-900 dark:text-white')}
                        ${renderStat('Offensive', db.filter(p=>p.category==='Offensive').length, 'text-red-600 dark:text-cyber-danger')}
                        ${renderStat('Defensive', db.filter(p=>p.category==='Defensive').length, 'text-emerald-600 dark:text-emerald-400')}
                        ${renderStat('Saved', savedIds.size, 'text-indigo-600 dark:text-cyber-cyan')}
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div class="glass p-6 rounded-lg tech-border"><h3 class="text-indigo-600 dark:text-cyber-blue font-mono mb-4 text-sm font-bold">DOMAINS</h3><div class="relative h-64"><canvas id="catChart"></canvas></div></div>
                        <div class="glass p-6 rounded-lg tech-border"><h3 class="text-purple-600 dark:text-cyber-purple font-mono mb-4 text-sm font-bold">DIFFICULTY</h3><div class="relative h-64"><canvas id="diffChart"></canvas></div></div>
                    </div>
                </div>`,
            explore: () => `
                <div class="max-w-7xl mx-auto px-4 py-8 h-[calc(100vh-100px)] flex flex-col animate-fade-in">
                    <div class="glass p-4 rounded-lg mb-6 flex flex-col md:flex-row gap-4 items-center justify-between border-b border-slate-200 dark:border-white/10">
                        <div class="relative w-full md:w-1/2"><i class="ph-bold ph-magnifying-glass absolute left-3 top-3 text-slate-400 dark:text-cyber-cyan"></i><input id="search" type="text" placeholder="Search 500+ Projects..." class="w-full bg-slate-50 dark:bg-black/40 border border-slate-300 dark:border-white/10 rounded py-2 pl-10 text-slate-900 dark:text-white focus:border-indigo-500 dark:focus:border-cyber-cyan outline-none text-sm"></div>
                        <div class="flex gap-2">
                            <select id="cat" class="bg-slate-50 dark:bg-black/40 text-slate-700 dark:text-gray-300 border border-slate-300 dark:border-white/10 rounded px-3 py-2 text-xs font-bold uppercase outline-none"><option value="All">All</option><option value="Offensive">Offensive</option><option value="Defensive">Defensive</option><option value="IoT">IoT</option><option value="Cloud">Cloud</option></select>
                            <select id="diff" class="bg-slate-50 dark:bg-black/40 text-slate-700 dark:text-gray-300 border border-slate-300 dark:border-white/10 rounded px-3 py-2 text-xs font-bold uppercase outline-none"><option value="All">All</option><option value="Beginner">Beginner</option><option value="Advanced">Advanced</option></select>
                        </div>
                    </div>
                    <div class="flex-1 overflow-y-auto pr-2 custom-scroll relative">
                        <div id="grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-8"></div>
                        <div id="load-more-btn" class="py-8 text-center hidden"><button onclick="loadMoreProjects()" class="btn-cyber px-12 py-3 rounded text-sm font-bold uppercase tracking-widest hover:scale-105 transition-transform">Load Next Batch</button></div>
                    </div>
                </div>`,
            saved: () => `
                <div class="max-w-7xl mx-auto px-4 py-8 h-[calc(100vh-100px)] flex flex-col animate-fade-in">
                    <div class="mb-6 border-b border-slate-200 dark:border-white/10 pb-4 flex items-center gap-4">
                        <div class="w-10 h-10 rounded-lg bg-indigo-100 dark:bg-cyber-cyan/10 flex items-center justify-center text-indigo-600 dark:text-cyber-cyan"><i class="ph-bold ph-bookmark-simple text-xl"></i></div>
                        <div><h1 class="text-2xl font-bold text-slate-900 dark:text-white">Saved Projects</h1><p class="text-xs text-slate-500 dark:text-gray-500">Collection: ${savedIds.size} items</p></div>
                    </div>
                    <div class="flex-1 overflow-y-auto pr-2 custom-scroll">
                        <div id="saved-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-8">
                            ${savedIds.size === 0 ? `<div class="col-span-full text-center py-20 text-slate-400 dark:text-gray-500 font-mono italic">NO SAVED PROJECTS</div>` : ''}
                        </div>
                    </div>
                </div>`,
            ai: () => `
                <div class="h-full flex items-center justify-center p-4 animate-fade-in">
                    <div class="glass p-1 rounded-2xl w-full max-w-2xl relative overflow-hidden tech-border">
                        <div class="absolute inset-0 bg-gradient-to-b from-transparent via-indigo-500/10 dark:via-cyber-cyan/5 to-transparent h-[10%] w-full animate-scan pointer-events-none"></div>
                        <div class="p-10 text-center relative z-10">
                            <i class="ph-duotone ph-brain text-6xl text-indigo-600 dark:text-cyber-cyan mb-6 animate-pulse"></i>
                            <h2 class="text-3xl font-bold text-slate-900 dark:text-white mb-2">CPH ARCHITECT</h2>
                            <p class="text-slate-500 dark:text-gray-400 mb-8 font-mono text-sm">Neural Network Initialized. State your requirements.</p>
                            <div class="grid grid-cols-2 gap-4 mb-6 text-left">
                                <div class="space-y-1"><label class="text-[10px] text-indigo-600 dark:text-cyber-blue font-bold uppercase">Target</label><select id="ai-domain" class="w-full bg-slate-50 dark:bg-black/50 border border-slate-300 dark:border-white/10 rounded px-3 py-3 text-slate-900 dark:text-white outline-none"><option value="Web Exploitation">Web Exploitation</option><option value="Malware Analysis">Malware Analysis</option></select></div>
                                <div class="space-y-1"><label class="text-[10px] text-purple-600 dark:text-cyber-purple font-bold uppercase">Level</label><select id="ai-difficulty" class="w-full bg-slate-50 dark:bg-black/50 border border-slate-300 dark:border-white/10 rounded px-3 py-3 text-slate-900 dark:text-white outline-none"><option value="Beginner">Beginner</option><option value="Advanced">Advanced</option></select></div>
                            </div>
                            <button onclick="window.generateCustomProject()" id="btn-generate-idea" class="btn-cyber w-full py-4 font-bold tracking-widest text-sm uppercase rounded hover:scale-105 transition-transform">Generate Blueprint</button>
                            <div id="ai-result-container" class="hidden mt-6 text-left bg-slate-50 dark:bg-black/30 p-4 rounded border border-slate-200 dark:border-white/10 animate-fade-in"><div id="ai-result-content"></div></div>
                        </div>
                    </div>
                </div>
            `
        };

        // --- ROUTER & LOGIC ---
        function router(page) {
            document.getElementById('main-container').innerHTML = views[page]();
            updateNav(page);
            
            // Clean up charts if leaving dashboard
            if(window.chart1) { window.chart1.destroy(); window.chart1 = null; }
            if(window.chart2) { window.chart2.destroy(); window.chart2 = null; }

            if(page === 'home') typeWriterEffect();
            if(page === 'dashboard') initCharts();
            if(page === 'explore') {
                initExplore();
                // Handle pre-search from Home page
                if(window.preSearch) {
                    document.getElementById('search').value = window.preSearch;
                    window.preSearch = null; // clear it
                    document.getElementById('search').dispatchEvent(new Event('input'));
                }
            }
            if(page === 'saved') initSaved();
        }

        function updateNav(page) {
            ['home','dashboard','explore','ai'].forEach(id => {
                const btn = document.getElementById(`nav-${id}`);
                const active = "px-4 py-1.5 rounded text-sm font-medium text-indigo-600 dark:text-cyber-cyan bg-indigo-50 dark:bg-cyber-cyan/10 border border-indigo-200 dark:border-cyber-cyan/30";
                const inactive = "px-4 py-1.5 rounded text-sm font-medium text-slate-500 dark:text-gray-400 hover:text-slate-900 dark:hover:text-white transition";
                if(btn) btn.className = (id === page || (page === 'saved' && id === '')) ? active : inactive;
            });
        }

        function typeWriterEffect() {
            const text = "A curated repository of 500+ offensive & defensive research projects.";
            const el = document.getElementById('hero-typewriter');
            let i = 0;
            if(el) { el.innerHTML = ''; const timer = setInterval(() => { if(i < text.length) { el.innerHTML += text.charAt(i); i++; } else clearInterval(timer); }, 30); }
        }

        function renderCard(p) {
            const c = p.category === 'Offensive' ? 'border-red-500/30 bg-red-50 dark:bg-black/40 text-red-600 dark:text-cyber-danger' : 'border-slate-300 dark:border-gray-400/30 bg-slate-50 dark:bg-black/40 text-slate-500 dark:text-gray-400';
            return `<div class="glass p-5 rounded relative overflow-hidden tech-card group cursor-pointer border border-slate-200 dark:border-white/5 hover:border-indigo-400 dark:hover:border-cyber-cyan/50 transition-colors card-hover" onclick="openModal(${p.id})">
                <div class="scan-line hidden dark:block"></div>
                <div class="flex justify-between items-start mb-4"><span class="text-[10px] font-bold uppercase px-2 py-0.5 rounded border ${c}">${p.category}</span><span class="font-mono text-xs text-slate-400 dark:text-gray-500">#${p.id}</span></div>
                <h3 class="text-lg font-bold text-slate-900 dark:text-white mb-2 group-hover:text-indigo-600 dark:group-hover:text-cyber-cyan transition-colors">${p.title}</h3>
                <p class="text-xs text-slate-500 dark:text-gray-400 font-mono mb-4 line-clamp-2">${p.desc}</p>
            </div>`;
        }
        function renderStat(label, val, color) { return `<div class="glass p-6 rounded text-center border-t-2 border-slate-200 dark:border-white/10 hover:border-indigo-500 dark:hover:border-cyber-cyan transition-colors"><div class="text-3xl font-bold ${color} font-mono">${val}</div><div class="text-[10px] text-slate-500 dark:text-gray-500 uppercase tracking-widest mt-2 font-bold">${label}</div></div>`; }

        function initExplore() {
            const grid = document.getElementById('grid');
            const search = document.getElementById('search');
            const cat = document.getElementById('cat');
            const diff = document.getElementById('diff');
            function render() {
                const filtered = db.filter(p => {
                    const mS = p.title.toLowerCase().includes(search.value.toLowerCase());
                    const mC = cat.value === 'All' || p.category === cat.value;
                    const mD = diff.value === 'All' || p.difficulty === diff.value;
                    return mS && mC && mD;
                });
                grid.innerHTML = filtered.slice(0, visibleCount).map(renderCard).join('');
                const btn = document.getElementById('load-more-btn');
                if(filtered.length > visibleCount) btn.classList.remove('hidden'); else btn.classList.add('hidden');
                if(filtered.length === 0) grid.innerHTML = `<div class="col-span-full text-center text-slate-400 dark:text-gray-500 py-20 font-mono">NO SIGNALS DETECTED</div>`;
            }
            [search, cat, diff].forEach(el => el.addEventListener('input', () => { visibleCount = 24; render(); }));
            window.loadMoreProjects = () => { visibleCount += 24; render(); };
            render();
        }

        function initSaved() {
            const grid = document.getElementById('saved-grid');
            if(savedIds.size > 0) {
                const savedList = db.filter(p => savedIds.has(p.id));
                grid.innerHTML = savedList.map(renderCard).join('');
            }
        }

        // --- MODAL ---
        window.toggleSaveProject = function() {
            if (!activeId) return;
            if (savedIds.has(activeId)) savedIds.delete(activeId); else savedIds.add(activeId);
            updateSaveIcon();
        }
        function updateSaveIcon() {
            const icon = document.getElementById('modal-save-icon');
            const btn = document.getElementById('modal-save-btn');
            if(!icon) return;
            if(savedIds.has(activeId)) {
                icon.className = "ph-fill ph-bookmark-simple text-indigo-500 dark:text-cyber-cyan";
                btn.className = "text-indigo-500 dark:text-cyber-cyan transition p-2 rounded-lg bg-indigo-50 dark:bg-white/10";
            } else {
                icon.className = "ph-bold ph-bookmark-simple";
                btn.className = "text-slate-400 hover:text-indigo-500 dark:hover:text-cyber-cyan transition p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-white/5";
            }
        }
        function openModal(id) {
            activeId = id;
            const p = db.find(x => x.id === id);
            document.getElementById('modal-title').innerText = p.title;
            document.getElementById('modal-category').innerText = p.category;
            document.getElementById('modal-desc').innerText = p.desc;
            document.getElementById('modal-utility').innerText = p.utility;
            document.getElementById('modal-mechanism').innerText = p.mechanism;
            document.getElementById('modal-stack').innerHTML = p.stack.map(s => `<span class="px-2 py-1 bg-indigo-50 dark:bg-cyber-blue/10 text-indigo-600 dark:text-cyber-blue rounded text-xs border border-indigo-100 dark:border-cyber-blue/20">${s}</span>`).join('');
            updateSaveIcon();
            const overlay = document.getElementById('modal-overlay');
            const content = document.getElementById('modal-content');
            overlay.classList.remove('hidden');
            requestAnimationFrame(() => { overlay.classList.remove('opacity-0'); content.classList.remove('scale-95'); content.classList.add('scale-100'); });
            switchTab('overview');
        }
        function closeModal() {
            const overlay = document.getElementById('modal-overlay');
            const content = document.getElementById('modal-content');
            overlay.classList.add('opacity-0'); content.classList.remove('scale-100'); content.classList.add('scale-95');
            setTimeout(() => overlay.classList.add('hidden'), 300);
            if(document.getElementById('saved-grid')) initSaved();
        }
        function switchTab(t) {
            document.getElementById('view-modal-overview').className = t === 'overview' ? 'space-y-6 animate-fade-in' : 'hidden';
            document.getElementById('view-modal-plan').className = t === 'plan' ? 'flex flex-col h-full animate-fade-in' : 'hidden';
            document.getElementById('tab-overview').className = t === 'overview' ? "px-6 py-2 text-sm font-bold text-indigo-600 dark:text-cyber-cyan border-b-2 border-indigo-600 dark:border-cyber-cyan bg-indigo-50 dark:bg-cyber-cyan/5 transition-all" : "px-6 py-2 text-sm font-bold text-slate-500 dark:text-gray-500 hover:text-slate-900 dark:hover:text-white transition-all";
            document.getElementById('tab-plan').className = t === 'plan' ? "px-6 py-2 text-sm font-bold text-indigo-600 dark:text-cyber-cyan border-b-2 border-indigo-600 dark:border-cyber-cyan bg-indigo-50 dark:bg-cyber-cyan/5 transition-all" : "px-6 py-2 text-sm font-bold text-slate-500 dark:text-gray-500 hover:text-slate-900 dark:hover:text-white transition-all";
        }

        window.generateImplementationPlan = function() {
            if (!activeId) return;
            const p = db.find(x => x.id === activeId);
            const loading = document.getElementById('plan-loading');
            const content = document.getElementById('plan-content');
            const intro = document.getElementById('plan-intro');
            intro.classList.add('hidden'); loading.classList.remove('hidden');
            setTimeout(() => {
                const mockPlan = `# üõ°Ô∏è Project Execution Plan: ${p.title}\n\n### 1. Environment Preparation\n* **OS:** Linux (Kali/Ubuntu) recommended.\n* **Dependencies:**\n    \`\`\`bash\n    sudo apt update\n    sudo apt install -y build-essential ${p.stack[0].toLowerCase()} git\n    \`\`\`\n\n### 2. Core Development\nThe heart of this project relies on **${p.stack[0]}** to interact with **${p.title.split(' ')[0]}**.\n\n#### Key Module Logic:\n\`\`\`${p.stack[0].toLowerCase()}\nfunction initiate_exploit() {\n    connect_to_target();\n    inject_payload("${p.mechanism.substring(0, 20)}...");\n}\n\`\`\`\n\n### 3. Validation\n* Verify **${p.utility}** output.`;
                if (typeof marked !== 'undefined' && marked.parse) { content.innerHTML = marked.parse(mockPlan); } else { content.innerText = mockPlan; }
                loading.classList.add('hidden'); content.classList.remove('hidden');
            }, 1500); 
        };

        window.generateCustomProject = function() {
            const btn = document.getElementById('btn-generate-idea');
            const resultDiv = document.getElementById('ai-result-content');
            const container = document.getElementById('ai-result-container');
            const domain = document.getElementById('ai-domain').value;
            const difficulty = document.getElementById('ai-difficulty').value;
            btn.disabled = true; btn.innerHTML = '<i class="ph-bold ph-spinner animate-spin mr-2"></i> ARCHITECTING...';
            container.classList.add('hidden');
            setTimeout(() => {
                const mockProject = { id: db.length + 1, title: `Custom ${domain} Protocol Analysis`, desc: `A specialized research initiative focusing on advanced ${domain.toLowerCase()} vectors.`, stack: ["Python", "Go", "Docker"], difficulty: difficulty, category: domain.split(' ')[0], mechanism: "Implements a polymorphic engine to bypass standard detection.", utility: "Critical for next-gen threat hunting." };
                db.unshift(mockProject);
                resultDiv.innerHTML = `<div class="flex justify-between items-start mb-4"><div><h3 class="font-bold text-xl text-slate-800 dark:text-slate-200">${mockProject.title}</h3><span class="text-xs font-mono text-indigo-600 dark:text-cyber-cyan border border-indigo-200 dark:border-cyber-cyan/30 px-2 py-0.5 rounded bg-indigo-50 dark:bg-cyber-cyan/10 mt-1 inline-block">${mockProject.difficulty}</span></div></div><p class="text-sm text-slate-600 dark:text-gray-400 mb-4 leading-relaxed">${mockProject.desc}</p><button onclick="openModal(${mockProject.id})" class="w-full btn-cyber py-2 rounded text-sm font-bold uppercase tracking-wider hover:scale-105 transition-transform"><i class="ph-bold ph-eye mr-2"></i> View Full Details</button>`;
                container.classList.remove('hidden');
                btn.disabled = false; btn.innerHTML = '‚ú® Generate Another Blueprint';
            }, 1500);
        };

        function initCharts() {
            const isDark = document.documentElement.classList.contains('dark');
            const textColor = isDark ? '#fff' : '#1e293b';
            const cats = {}; db.forEach(p => cats[p.category] = (cats[p.category]||0)+1);
            window.chart1 = new Chart(document.getElementById('catChart'), { type: 'doughnut', data: { labels: Object.keys(cats), datasets: [{ data: Object.values(cats), backgroundColor: ['#ef4444', '#06b6d4', '#a855f7', '#3b82f6', '#f59e0b'], borderWidth: 0 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { color: textColor } } } } });
            const diffs = {}; db.forEach(p => diffs[p.difficulty] = (diffs[p.difficulty]||0)+1);
            window.chart2 = new Chart(document.getElementById('diffChart'), { type: 'bar', data: { labels: Object.keys(diffs), datasets: [{ label: 'Count', data: Object.values(diffs), backgroundColor: '#3b82f6' }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { grid: { color: isDark ? '#ffffff10' : '#00000010' }, ticks: { color: textColor } }, x: { grid: { display: false }, ticks: { color: textColor } } }, plugins: { legend: { display: false } } } });
        }
        // BG Animation
        const canvas = document.getElementById('bg-canvas'); const ctx = canvas.getContext('2d');
        let width, height, particles = [];
        function resize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize); resize();
        class Particle { constructor() { this.x=Math.random()*width; this.y=Math.random()*height; this.vx=(Math.random()-0.5)*0.5; this.vy=(Math.random()-0.5)*0.5; this.size=Math.random()*2; } update() { this.x+=this.vx; this.y+=this.vy; if(this.x<0||this.x>width)this.vx*=-1; if(this.y<0||this.y>height)this.vy*=-1; } draw() { const isDark = document.documentElement.classList.contains('dark'); ctx.fillStyle = isDark ? 'rgba(0, 243, 255, 0.5)' : 'rgba(79, 70, 229, 0.3)'; ctx.beginPath(); ctx.arc(this.x,this.y,this.size,0,Math.PI*2); ctx.fill(); } }
        for(let i=0; i<60; i++) particles.push(new Particle());
        function animate() { ctx.clearRect(0,0,width,height); const isDark = document.documentElement.classList.contains('dark'); particles.forEach(p => { p.update(); p.draw(); particles.forEach(q => { const dx=p.x-q.x, dy=p.y-q.y, dist=Math.sqrt(dx*dx+dy*dy); if(dist<100) { ctx.strokeStyle = isDark ? `rgba(0, 243, 255, ${1-dist/100})` : `rgba(79, 70, 229, ${0.5-dist/200})`; ctx.lineWidth=0.5; ctx.beginPath(); ctx.moveTo(p.x,p.y); ctx.lineTo(q.x,q.y); ctx.stroke(); } }); }); requestAnimationFrame(animate); }
        animate();
        setTimeout(() => { document.getElementById('splash').style.opacity='0'; setTimeout(() => { document.getElementById('splash').style.display='none'; router('home'); }, 500); }, 2000);
    </script>
</body>
</html>